# This is a basic workflow to help you get started with Actions

name: CI

# Controls when the workflow will run
on:
  issues:
    types: [created, edited, labeled]

jobs:
  deploy-aks:
    if: github.event_name == 'issues' && contains(github.event.issue.labels.*.name, 'create-cluster')
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v1
        with:
          node-version: 12
      
      - name: Add comment
        uses: peter-evans/create-or-update-comment@a35cf36e5301d70b76f316e867e7788a55a31dae
        with:
          issue-number: ${{ github.event.issue.number }}
          body: |
            **Hey there!** I'm taking good care of your issue and will create the cluster.
            
      - name: Issue Form Body Parser
        id: parser
        uses: peter-murray/issue-forms-body-parser@v2.0.0
        with:
          issue_id: ${{ github.event.issue.number }}
          
      - name: Add comment
        uses: peter-evans/create-or-update-comment@a35cf36e5301d70b76f316e867e7788a55a31dae
        with:
          issue-number: ${{ github.event.issue.number }}
          body: |
            Here are the parsed fields:          
            ```
            ${{ steps.parser.outputs.payload }}
            ```
            
      - name: GitHub Issue Parser
        id: issue-parser
        uses: stefanbuck/github-issue-parser@v2.0.3    
        with:
          template-path: .github/ISSUE_TEMPLATE/CLUSTER_CREATION.yml
        
      - run: echo '${{ steps.issue-parser.outputs.jsonString }}'
          
      - name: Show parsed data JSON
        run: |
          echo "${{ steps.parser.outputs.payload }}"
